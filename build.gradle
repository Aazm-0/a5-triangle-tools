plugins {
    id 'java'
}

java {
    sourceCompatibility = 21
}

subprojects.each { subproject ->
    evaluationDependsOn(subproject.path)
}

jar {
    duplicatesStrategy = DuplicatesStrategy.EXCLUDE

    manifest {
        attributes('Main-Class': 'triangle.Compiler')
    }

    dependsOn subprojects.build


    from subprojects.collect { subproject ->
        subproject.sourceSets.main.output
    }

    from subprojects.collect { subproject ->
        subproject.configurations.runtimeClasspath.collect {
            it.isDirectory() ? it : zipTree(it)
        }
    }.flatten()
}